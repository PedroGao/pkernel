# 内核堆内存管理

前面的两个小节都是关于内核在内存上面的管理，我们分别引入了 `物理内存` 和 `虚拟内存` 。

同时，也引入了虚拟页和物理页来管理内存，但是我们都知道在程序运行的时候有一个巨大的内存区叫做
`堆` 。在 C 语言中可以通过 `malloc` 和 `free` 来分配和释放堆内存，堆的意义不言而喻，它
是程序运行的必备组件。

关于堆的介绍和实现算法有很多，了解推荐阅读 `CSAPP` 的第九章。本小节，会实现一种最简单的
堆内存管理算法——侵入式链表管理方法。

## 实现

这里具体算法实现就不多说了，重要的是实现三个函数，分别是 `init_heap` ， `kmalloc` 和 `kfree` 。

* init_heap：初始化堆内存，其实就是添加一个堆头指针
* kmalloc：分配一块或多块内存给程序，注意内存对齐。
* kfree：释放掉内存，不会更改内存数据，标记内存块的属性即可。

## 总结

这里已经是内存管理的最后一小节了，从物理页、虚拟页再到堆内存，我们对内存的管理其实是比较麻烦的，可想而知
在真实的操作系统中对于内存的管理其实是更加麻烦的，虚拟内存是一次非常伟大的抽象，大大提升了程序健壮性和兼容
性。
